<UserControl x:Class="SshManager.Terminal.Controls.SshTerminalControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:SshManager.Terminal.Controls"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800"
             Background="{DynamicResource SolidBackgroundFillColorBaseBrush}"
             PreviewKeyDown="UserControl_PreviewKeyDown">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Terminal Control - uses WebView2-based xterm.js rendering -->
        <local:WebTerminalControl x:Name="TerminalHost"
                                   Grid.Row="0"
                                   MinHeight="100"
                                   MinWidth="200"
                                   Focusable="True"/>

        <!-- Serial Controls Panel (shown only for serial connections) -->
        <Border x:Name="SerialControlsPanel"
                Grid.Row="1"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                Padding="8,4"
                Visibility="Collapsed">
            <StackPanel Orientation="Horizontal">
                <!-- Local Echo Toggle -->
                <CheckBox x:Name="LocalEchoCheckBox"
                          Content="Local Echo"
                          Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                          VerticalAlignment="Center"
                          Margin="0,0,16,0"
                          ToolTip="Echo typed characters locally (for devices that don't echo input)"
                          Checked="LocalEchoCheckBox_Checked"
                          Unchecked="LocalEchoCheckBox_Unchecked"/>

                <!-- DTR (Data Terminal Ready) Toggle -->
                <ToggleButton x:Name="DtrToggleButton"
                              Content="DTR"
                              Padding="8,2"
                              Margin="0,0,8,0"
                              ToolTip="Toggle DTR (Data Terminal Ready) signal"
                              Checked="DtrToggleButton_Checked"
                              Unchecked="DtrToggleButton_Unchecked"/>

                <!-- RTS (Request To Send) Toggle -->
                <ToggleButton x:Name="RtsToggleButton"
                              Content="RTS"
                              Padding="8,2"
                              Margin="0,0,8,0"
                              ToolTip="Toggle RTS (Request To Send) signal"
                              Checked="RtsToggleButton_Checked"
                              Unchecked="RtsToggleButton_Unchecked"/>

                <!-- Send Break Button -->
                <Button x:Name="SendBreakButton"
                        Content="Break"
                        Padding="8,2"
                        ToolTip="Send break signal (250ms)"
                        Click="SendBreakButton_Click"/>
            </StackPanel>
        </Border>

        <!-- Status Bar -->
        <local:TerminalStatusBar x:Name="StatusBar"
                                  Grid.Row="2"
                                  Visibility="Collapsed"/>

        <!-- Find Overlay - positioned at top-right of terminal -->
        <!-- Note: Due to HwndHost airspace constraints, this overlay appears above the terminal
             but may not overlap perfectly with terminal content during rendering -->
        <local:TerminalFindOverlay x:Name="FindOverlay"
                                    Grid.Row="0"
                                    Visibility="Collapsed"
                                    Panel.ZIndex="100"/>

        <!-- Status Overlay (Connecting/Disconnected messages) -->
        <Border x:Name="StatusOverlay"
                Grid.Row="0"
                Background="{DynamicResource SmokeFillColorDefaultBrush}"
                Visibility="Collapsed"
                Panel.ZIndex="50">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <ProgressBar x:Name="StatusProgress"
                             IsIndeterminate="True"
                             Width="200"
                             Height="4"
                             Margin="0,0,0,12"
                             Visibility="Collapsed"/>
                <TextBlock x:Name="StatusText"
                           Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                           FontSize="14"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
