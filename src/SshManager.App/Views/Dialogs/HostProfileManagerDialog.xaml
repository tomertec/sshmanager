<ui:FluentWindow x:Class="SshManager.App.Views.Dialogs.HostProfileManagerDialog"
                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                xmlns:converters="clr-namespace:SshManager.App.Converters"
                mc:Ignorable="d"
                Title="Host Profiles"
                Height="600" Width="800"
                MinHeight="500" MinWidth="700"
                WindowStartupLocation="CenterOwner"
                ResizeMode="CanResizeWithGrip"
                ExtendsContentIntoTitleBar="True"
                WindowBackdropType="Mica">

    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
    </ui:FluentWindow.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0"
                     Title="Host Profiles"
                     ShowMaximize="False"
                     ShowMinimize="False" />

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="24,16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Toolbar -->
            <Grid Grid.Row="0" Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <ui:Button Icon="{ui:SymbolIcon Add24}"
                              Content="Add Profile"
                              Command="{Binding AddProfileCommand}"
                              Margin="0,0,8,0" />
                    <ui:Button Icon="{ui:SymbolIcon Edit24}"
                              Content="Edit"
                              Command="{Binding EditProfileCommand}"
                              Margin="0,0,8,0" />
                    <ui:Button Icon="{ui:SymbolIcon Delete24}"
                              Content="Delete"
                              Command="{Binding DeleteProfileCommand}" />
                </StackPanel>
            </Grid>

            <!-- Profiles List -->
            <Border Grid.Row="1"
                   Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                   BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                   BorderThickness="1"
                   CornerRadius="8"
                   Padding="0">
                <Grid>
                    <!-- Loading Indicator -->
                    <ui:ProgressRing IsIndeterminate="True"
                                    Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                                    Width="48" Height="48" />

                    <!-- Profiles DataGrid -->
                    <DataGrid ItemsSource="{Binding Profiles}"
                             SelectedItem="{Binding SelectedProfile}"
                             AutoGenerateColumns="False"
                             IsReadOnly="True"
                             GridLinesVisibility="None"
                             HeadersVisibility="Column"
                             CanUserResizeRows="False"
                             SelectionMode="Single"
                             Background="Transparent"
                             BorderThickness="0"
                             RowHeight="40"
                             Visibility="{Binding IsLoading, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Display Name"
                                              Binding="{Binding DisplayName}"
                                              Width="*"
                                              MinWidth="150" />
                            <DataGridTextColumn Header="Description"
                                              Binding="{Binding Description}"
                                              Width="2*"
                                              MinWidth="200" />
                            <DataGridTextColumn Header="Username"
                                              Binding="{Binding DefaultUsername}"
                                              Width="*"
                                              MinWidth="100" />
                            <DataGridTextColumn Header="Port"
                                              Binding="{Binding DefaultPort}"
                                              Width="80" />
                            <DataGridTextColumn Header="Auth Type"
                                              Binding="{Binding AuthType}"
                                              Width="120" />
                        </DataGrid.Columns>
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
                                <EventSetter Event="MouseDoubleClick" Handler="DataGridRow_MouseDoubleClick" />
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>

                    <!-- Empty State -->
                    <StackPanel HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Visibility="{Binding Profiles.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=invert}">
                        <ui:SymbolIcon Symbol="Document24"
                                      FontSize="48"
                                      Opacity="0.3"
                                      Margin="0,0,0,16" />
                        <TextBlock Text="No host profiles defined"
                                  FontSize="16"
                                  Opacity="0.6"
                                  HorizontalAlignment="Center"
                                  Margin="0,0,0,8" />
                        <TextBlock Text="Create a profile to define common settings for multiple hosts"
                                  FontSize="12"
                                  Opacity="0.5"
                                  HorizontalAlignment="Center" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Error Message -->
            <Border Grid.Row="1"
                   Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"
                   Background="#30FF4444"
                   BorderBrush="#FFFF4444"
                   BorderThickness="1"
                   CornerRadius="4"
                   Padding="12"
                   Margin="0,0,0,16"
                   VerticalAlignment="Bottom">
                <TextBlock Text="{Binding ErrorMessage}"
                          Foreground="#FFFF4444"
                          TextWrapping="Wrap" />
            </Border>
        </Grid>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" Margin="24,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ui:Button Grid.Column="1"
                      Content="Close"
                      Command="{Binding CloseCommand}"
                      MinWidth="80" />
        </Grid>
    </Grid>
</ui:FluentWindow>
