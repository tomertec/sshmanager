<ui:FluentWindow x:Class="SshManager.App.Views.Dialogs.BackupRestoreDialog"
                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                mc:Ignorable="d"
                Title="Backup Manager"
                Height="550" Width="650"
                MinHeight="450" MinWidth="550"
                WindowStartupLocation="CenterOwner"
                ExtendsContentIntoTitleBar="True"
                WindowBackdropType="Mica">

    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </ui:FluentWindow.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0"
                     Title="Backup Manager"
                     ShowMaximize="True"
                     ShowMinimize="False" />

        <!-- Header Info -->
        <Grid Grid.Row="1" Margin="16,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="Backup Directory"
                          FontWeight="SemiBold"
                          Margin="0,0,0,4" />
                <TextBlock Text="{Binding BackupDirectory}"
                          FontSize="12"
                          Opacity="0.7"
                          TextTrimming="CharacterEllipsis"
                          ToolTip="{Binding BackupDirectory}" />
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <ui:Button Content="Open Folder"
                          Icon="{ui:SymbolIcon FolderOpen24}"
                          Command="{Binding OpenBackupDirectoryCommand}"
                          Margin="0,0,8,0" />
                <ui:Button Content="Create Backup"
                          Icon="{ui:SymbolIcon Add24}"
                          Appearance="Primary"
                          Command="{Binding CreateBackupCommand}" />
            </StackPanel>
        </Grid>

        <!-- Backup List -->
        <DataGrid Grid.Row="2"
                 ItemsSource="{Binding Backups}"
                 SelectedItem="{Binding SelectedBackup}"
                 AutoGenerateColumns="False"
                 IsReadOnly="True"
                 SelectionMode="Single"
                 Margin="16,8"
                 CanUserAddRows="False"
                 CanUserDeleteRows="False"
                 HeadersVisibility="Column"
                 GridLinesVisibility="Horizontal">
            <DataGrid.Columns>
                <DataGridTemplateColumn Header="Backup" Width="*" MinWidth="200">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="4">
                                <ui:SymbolIcon Symbol="Document24" Margin="0,0,8,0" />
                                <StackPanel>
                                    <TextBlock Text="{Binding FileName}"
                                              FontWeight="SemiBold" />
                                    <TextBlock FontSize="11" Opacity="0.6">
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0} hosts, {1} groups">
                                                <Binding Path="HostCount" />
                                                <Binding Path="GroupCount" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="Created"
                                   Binding="{Binding CreatedAt, StringFormat={}{0:g}}"
                                   Width="140" />

                <DataGridTextColumn Header="Size"
                                   Binding="{Binding FileSizeFormatted}"
                                   Width="80" />

                <DataGridTemplateColumn Header="Actions" Width="140">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="4">
                                <ui:Button Content="Restore"
                                          Appearance="Primary"
                                          Command="{Binding DataContext.RestoreBackupCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                          CommandParameter="{Binding}"
                                          Padding="8,4"
                                          FontSize="11"
                                          Margin="0,0,4,0" />
                                <ui:Button Icon="{ui:SymbolIcon Delete24}"
                                          Appearance="Danger"
                                          Command="{Binding DataContext.DeleteBackupCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                          CommandParameter="{Binding}"
                                          Padding="4"
                                          FontSize="11"
                                          ToolTip="Delete backup" />
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Empty State -->
        <StackPanel Grid.Row="2"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Visibility="{Binding HasNoBackups, Converter={StaticResource BoolToVisibilityConverter}}">
            <ui:SymbolIcon Symbol="DocumentError24"
                          FontSize="48"
                          Opacity="0.5"
                          Margin="0,0,0,16" />
            <TextBlock Text="No backups found"
                      FontSize="16"
                      Opacity="0.7"
                      HorizontalAlignment="Center" />
            <TextBlock Text="Create a backup to protect your data"
                      FontSize="12"
                      Opacity="0.5"
                      HorizontalAlignment="Center"
                      Margin="0,4,0,0" />
        </StackPanel>

        <!-- Loading Indicator -->
        <ui:ProgressRing Grid.Row="2"
                        IsIndeterminate="True"
                        Width="48"
                        Height="48"
                        Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}" />

        <!-- Action Buttons -->
        <Grid Grid.Row="3" Margin="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <TextBlock Text="{Binding Backups.Count, StringFormat={}{0} backup(s)}"
                          VerticalAlignment="Center"
                          Opacity="0.7" />
            </StackPanel>

            <ui:Button Grid.Column="2"
                      Content="Close"
                      Command="{Binding CloseCommand}"
                      MinWidth="80" />
        </Grid>
    </Grid>
</ui:FluentWindow>
