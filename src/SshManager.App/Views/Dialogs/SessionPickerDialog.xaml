<ui:FluentWindow x:Class="SshManager.App.Views.Dialogs.SessionPickerDialog"
                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                mc:Ignorable="d"
                Title="Choose Session for New Pane"
                Height="500" Width="450"
                MinHeight="400" MinWidth="350"
                WindowStartupLocation="CenterOwner"
                ExtendsContentIntoTitleBar="True"
                WindowBackdropType="Mica">

    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <local:CountToVisibilityConverter x:Key="CountToVisibilityConverter"
                                          xmlns:local="clr-namespace:SshManager.App.Converters" />
    </ui:FluentWindow.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0"
                     Title="Choose Session for New Pane"
                     ShowMaximize="False"
                     ShowMinimize="False" />

        <!-- Tab Control -->
        <TabControl Grid.Row="1"
                    Margin="16,8,16,0"
                    SelectedIndex="{Binding SelectedTabIndex}">

            <!-- New Connection Tab -->
            <TabItem Header="New Connection">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Search -->
                    <ui:TextBox Grid.Row="0"
                               Margin="0,8,0,8"
                               Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                               PlaceholderText="Search hosts..."
                               Icon="{ui:SymbolIcon Search24}" />

                    <!-- Host List -->
                    <ListBox Grid.Row="1"
                             ItemsSource="{Binding FilteredHosts}"
                             SelectedItem="{Binding SelectedHost}"
                             MouseDoubleClick="HostList_MouseDoubleClick"
                             BorderThickness="1"
                             BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <ui:SymbolIcon Grid.Column="0" Grid.RowSpan="2"
                                                  Symbol="Server24"
                                                  FontSize="24"
                                                  Margin="0,0,12,0"
                                                  VerticalAlignment="Center" />

                                    <TextBlock Grid.Column="1" Grid.Row="0"
                                               Text="{Binding DisplayName}"
                                               FontWeight="SemiBold"
                                               FontSize="14" />

                                    <TextBlock Grid.Column="1" Grid.Row="1"
                                               Text="{Binding Host}"
                                               Opacity="0.6"
                                               FontSize="12" />
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </TabItem>

            <!-- Existing Sessions Tab -->
            <TabItem Header="Mirror Session">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Margin="0,8,0,8"
                               Text="Select an active session to mirror in the new pane:"
                               Opacity="0.7" />

                    <!-- Session List -->
                    <ListBox Grid.Row="1"
                             ItemsSource="{Binding ActiveSessions}"
                             SelectedItem="{Binding SelectedSession}"
                             MouseDoubleClick="SessionList_MouseDoubleClick"
                             BorderThickness="1"
                             BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <ui:SymbolIcon Grid.Column="0" Grid.RowSpan="2"
                                                  Symbol="DesktopSignal24"
                                                  FontSize="24"
                                                  Margin="0,0,12,0"
                                                  VerticalAlignment="Center" />

                                    <TextBlock Grid.Column="1" Grid.Row="0"
                                               Text="{Binding Title}"
                                               FontWeight="SemiBold"
                                               FontSize="14" />

                                    <TextBlock Grid.Column="1" Grid.Row="1"
                                               Text="{Binding Host.Host}"
                                               Opacity="0.6"
                                               FontSize="12" />
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <!-- No sessions message -->
                    <TextBlock Grid.Row="1"
                               Text="No active sessions available"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Opacity="0.5"
                               Visibility="{Binding ActiveSessions.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=invert, FallbackValue=Collapsed}" />
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Buttons -->
        <Grid Grid.Row="2" Margin="16,8,16,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ui:Button Grid.Column="0"
                       Content="Empty Pane"
                       Command="{Binding CreateEmptyCommand}"
                       ToolTip="Create an empty pane without a session" />

            <ui:Button Grid.Column="2"
                       Content="Select"
                       Appearance="Primary"
                       Margin="0,0,8,0"
                       Click="Select_Click" />

            <ui:Button Grid.Column="3"
                       Content="Cancel"
                       IsCancel="True"
                       Command="{Binding CancelCommand}" />
        </Grid>
    </Grid>
</ui:FluentWindow>
