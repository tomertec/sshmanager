<ui:FluentWindow x:Class="SshManager.App.Views.Dialogs.SettingsDialog"
                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                xmlns:converters="clr-namespace:SshManager.App.Converters"
                mc:Ignorable="d"
                Title="Settings"
                Height="750" Width="800"
                MinHeight="650" MinWidth="700"
                WindowStartupLocation="CenterOwner"
                ResizeMode="CanResize"
                ExtendsContentIntoTitleBar="True"
                WindowBackdropType="Mica">

    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        <converters:BoolToPrimaryAppearanceConverter x:Key="BoolToPrimaryAppearanceConverter" />
        <converters:InverseBoolToPrimaryAppearanceConverter x:Key="InverseBoolToPrimaryAppearanceConverter" />
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
        <converters:EnumToDescriptionConverter x:Key="EnumToDescriptionConverter" />
        <converters:StringToBrushConverter x:Key="StringToBrushConverter" />

        <!-- Style for navigation items -->
        <Style x:Key="SettingsNavItemStyle" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="12,10" />
            <Setter Property="Margin" Value="4,2" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Border"
                                Background="Transparent"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}"
                                Margin="{TemplateBinding Margin}">
                            <ContentPresenter />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{ui:ThemeResource ControlFillColorSecondaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{ui:ThemeResource ControlFillColorDefaultBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </ui:FluentWindow.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0"
                     Title="Settings"
                     ShowMaximize="True"
                     ShowMinimize="False" />

        <!-- Main Content: Sidebar + Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="180" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Sidebar Navigation -->
            <Border Grid.Column="0"
                    Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                    BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="0,0,1,0">
                <ListBox ItemsSource="{Binding SettingsCategories}"
                         SelectedItem="{Binding SelectedSettingsCategory}"
                         Background="Transparent"
                         BorderThickness="0"
                         Padding="8,12"
                         ItemContainerStyle="{StaticResource SettingsNavItemStyle}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="Terminal24" Margin="0,0,12,0" FontSize="16">
                                    <ui:SymbolIcon.Style>
                                        <Style TargetType="ui:SymbolIcon">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding}" Value="Terminal">
                                                    <Setter Property="Symbol" Value="Terminal24" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding}" Value="Connection">
                                                    <Setter Property="Symbol" Value="PlugConnected24" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding}" Value="Security">
                                                    <Setter Property="Symbol" Value="Shield24" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding}" Value="Appearance">
                                                    <Setter Property="Symbol" Value="PaintBrush24" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding}" Value="Behavior">
                                                    <Setter Property="Symbol" Value="Settings24" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding}" Value="Data">
                                                    <Setter Property="Symbol" Value="Database24" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding}" Value="Backup &amp; Sync">
                                                    <Setter Property="Symbol" Value="Cloud24" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ui:SymbolIcon.Style>
                                </ui:SymbolIcon>
                                <TextBlock Text="{Binding}" VerticalAlignment="Center" />
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Border>

            <!-- Content Area -->
            <ScrollViewer Grid.Column="1"
                          VerticalScrollBarVisibility="Auto"
                          Padding="24,16">

                <Grid>
                    <!-- ===== Terminal Category ===== -->
                    <StackPanel x:Name="TerminalPanel">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedSettingsCategory}" Value="Terminal">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Terminal"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,16" />

                        <!-- Terminal Mode -->
                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Terminal Mode" FontWeight="SemiBold" />
                                    <TextBlock Text="Choose how SSH connections open"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                    CornerRadius="6"
                                    BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    Padding="4">
                                <StackPanel Orientation="Horizontal">
                                    <ui:Button Content="Embedded"
                                               Icon="{ui:SymbolIcon Window24}"
                                               Appearance="{Binding UseEmbeddedTerminal, Converter={StaticResource BoolToPrimaryAppearanceConverter}}"
                                               Command="{Binding SetEmbeddedTerminalCommand}"
                                               CommandParameter="True"
                                               Padding="12,8"
                                               Margin="0,0,4,0" />
                                    <ui:Button Content="External"
                                               Icon="{ui:SymbolIcon Open24}"
                                               Appearance="{Binding UseEmbeddedTerminal, Converter={StaticResource InverseBoolToPrimaryAppearanceConverter}}"
                                               Command="{Binding SetEmbeddedTerminalCommand}"
                                               CommandParameter="False"
                                               Padding="12,8" />
                                </StackPanel>
                            </Border>
                        </ui:CardControl>

                        <!-- Font Settings -->
                        <ui:CardExpander IsExpanded="False" Margin="0,0,0,8">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="Font Settings" FontWeight="SemiBold" />
                                    <TextBlock Text="Customize terminal appearance"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <TextBlock Text="Font Family" Margin="0,0,0,4" />
                                <ComboBox ItemsSource="{Binding AvailableFonts}"
                                          SelectedItem="{Binding TerminalFontFamily}"
                                          Margin="0,0,0,12" />

                                <TextBlock Text="Font Size" Margin="0,0,0,4" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="60" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="8"
                                            Maximum="24"
                                            Value="{Binding TerminalFontSize}"
                                            TickFrequency="1"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding TerminalFontSize, StringFormat={}{0} pt}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>

                                <TextBlock Text="Scrollback Buffer Size" Margin="0,12,0,4" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="70" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="1000"
                                            Maximum="100000"
                                            Value="{Binding ScrollbackBufferSize}"
                                            TickFrequency="1000"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ScrollbackBufferSize, StringFormat={}{0:N0}}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>
                                <TextBlock Text="Number of lines to keep in terminal history"
                                           FontSize="11"
                                           Opacity="0.5"
                                           Margin="0,4,0,0" />
                            </StackPanel>
                        </ui:CardExpander>

                        <!-- Terminal Theme -->
                        <ui:CardExpander IsExpanded="True" Margin="0,0,0,8">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="Terminal Theme" FontWeight="SemiBold" />
                                    <TextBlock Text="Color scheme for the terminal"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <TextBlock Text="Select Theme" Margin="0,0,0,4" />
                                <ComboBox ItemsSource="{Binding AvailableTerminalThemes}"
                                          SelectedItem="{Binding SelectedTerminalTheme}"
                                          DisplayMemberPath="Name"
                                          Margin="0,0,0,12" />

                                <!-- Theme Preview -->
                                <TextBlock Text="Preview" Margin="0,0,0,4" FontWeight="SemiBold" />
                                <Border x:Name="ThemePreviewBorder"
                                        Background="{Binding SelectedTerminalTheme.Background, Converter={StaticResource StringToBrushConverter}, FallbackValue=#1e1e1e, TargetNullValue=#1e1e1e}"
                                        CornerRadius="6"
                                        Padding="12"
                                        Margin="0,0,0,12"
                                        MinHeight="80">
                                    <StackPanel>
                                        <TextBlock Text="user@server:~$ ls -la"
                                                   FontFamily="Cascadia Mono"
                                                   FontSize="12"
                                                   Foreground="{Binding SelectedTerminalTheme.Foreground, Converter={StaticResource StringToBrushConverter}, FallbackValue=#CCCCCC, TargetNullValue=#CCCCCC}" />
                                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                            <TextBlock Text="drwxr-xr-x  " FontFamily="Cascadia Mono" FontSize="12"
                                                       Foreground="{Binding SelectedTerminalTheme.Blue, Converter={StaticResource StringToBrushConverter}, FallbackValue=#0037DA, TargetNullValue=#0037DA}" />
                                            <TextBlock Text="documents" FontFamily="Cascadia Mono" FontSize="12"
                                                       Foreground="{Binding SelectedTerminalTheme.Blue, Converter={StaticResource StringToBrushConverter}, FallbackValue=#0037DA, TargetNullValue=#0037DA}" />
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                            <TextBlock Text="-rw-r--r--  " FontFamily="Cascadia Mono" FontSize="12"
                                                       Foreground="{Binding SelectedTerminalTheme.Foreground, Converter={StaticResource StringToBrushConverter}, FallbackValue=#CCCCCC, TargetNullValue=#CCCCCC}" />
                                            <TextBlock Text="config.yaml" FontFamily="Cascadia Mono" FontSize="12"
                                                       Foreground="{Binding SelectedTerminalTheme.Green, Converter={StaticResource StringToBrushConverter}, FallbackValue=#13A10E, TargetNullValue=#13A10E}" />
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                            <TextBlock Text="-rwxr-xr-x  " FontFamily="Cascadia Mono" FontSize="12"
                                                       Foreground="{Binding SelectedTerminalTheme.Foreground, Converter={StaticResource StringToBrushConverter}, FallbackValue=#CCCCCC, TargetNullValue=#CCCCCC}" />
                                            <TextBlock Text="script.sh" FontFamily="Cascadia Mono" FontSize="12"
                                                       Foreground="{Binding SelectedTerminalTheme.Red, Converter={StaticResource StringToBrushConverter}, FallbackValue=#C50F1F, TargetNullValue=#C50F1F}" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Import/Export Buttons -->
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                                    <ui:Button Content="Import Theme"
                                               Icon="{ui:SymbolIcon ArrowDownload24}"
                                               Command="{Binding ImportTerminalThemeCommand}"
                                               Margin="0,0,8,0" />
                                    <ui:Button Content="Export Theme"
                                               Icon="{ui:SymbolIcon ArrowUpload24}"
                                               Command="{Binding ExportTerminalThemeCommand}"
                                               Margin="0,0,8,0" />
                                    <ui:Button Content="Delete"
                                               Icon="{ui:SymbolIcon Delete24}"
                                               Appearance="Caution"
                                               Command="{Binding DeleteTerminalThemeCommand}"
                                               IsEnabled="{Binding SelectedTerminalTheme.IsBuiltIn, Converter={StaticResource InverseBoolConverter}, FallbackValue=False}" />
                                </StackPanel>
                            </StackPanel>
                        </ui:CardExpander>

                        <!-- Autocompletion Settings -->
                        <ui:CardExpander Header="Autocompletion" IsExpanded="False" Margin="0,0,0,8">
                            <ui:CardExpander.Icon>
                                <ui:SymbolIcon Symbol="Keyboard24" />
                            </ui:CardExpander.Icon>
                            <StackPanel Margin="0,16,0,0">

                                <!-- Enable Toggle -->
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Enable Autocompletion" Style="{StaticResource BodyTextBlockStyle}" />
                                        <TextBlock Text="Show suggestions when pressing Tab in terminal"
                                                   Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" />
                                    </StackPanel>
                                    <ui:ToggleSwitch Grid.Column="1" IsChecked="{Binding EnableAutocompletion}" />
                                </Grid>

                                <!-- Mode Selection -->
                                <StackPanel IsEnabled="{Binding EnableAutocompletion}" Margin="0,0,0,16">
                                    <TextBlock Text="Completion Mode" Style="{StaticResource BodyTextBlockStyle}" Margin="0,0,0,8" />
                                    <ComboBox ItemsSource="{Binding AutocompletionModes}"
                                              SelectedItem="{Binding AutocompletionMode}"
                                              Width="200" HorizontalAlignment="Left">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Converter={StaticResource EnumToDescriptionConverter}}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                    <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                               Margin="0,4,0,0">
                                        <Run Text="RemoteShell: Get completions from remote server" />
                                        <LineBreak />
                                        <Run Text="LocalHistory: Use locally stored command history" />
                                        <LineBreak />
                                        <Run Text="Hybrid: Combine both sources" />
                                    </TextBlock>
                                </StackPanel>

                                <!-- Debounce Slider -->
                                <StackPanel IsEnabled="{Binding EnableAutocompletion}" Margin="0,0,0,16">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="60" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Debounce Delay" Style="{StaticResource BodyTextBlockStyle}" />
                                        <TextBlock Grid.Column="1" Text="{Binding AutocompletionDebounceMs, StringFormat={}{0}ms}"
                                                   HorizontalAlignment="Right" />
                                    </Grid>
                                    <Slider Minimum="50" Maximum="1000"
                                            Value="{Binding AutocompletionDebounceMs}"
                                            TickFrequency="50" IsSnapToTickEnabled="True" />
                                </StackPanel>

                                <!-- Max Suggestions Slider -->
                                <StackPanel IsEnabled="{Binding EnableAutocompletion}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="40" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Maximum Suggestions" Style="{StaticResource BodyTextBlockStyle}" />
                                        <TextBlock Grid.Column="1" Text="{Binding MaxCompletionSuggestions}"
                                                   HorizontalAlignment="Right" />
                                    </Grid>
                                    <Slider Minimum="5" Maximum="50"
                                            Value="{Binding MaxCompletionSuggestions}"
                                            TickFrequency="5" IsSnapToTickEnabled="True" />
                                </StackPanel>
                            </StackPanel>
                        </ui:CardExpander>

                        <!-- X11 Forwarding -->
                        <ui:CardExpander IsExpanded="False" Margin="0,0,0,8">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="X11 Forwarding" FontWeight="SemiBold" />
                                    <TextBlock Text="Configure X11 forwarding and X server settings"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <!-- Default X11 forwarding toggle -->
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Enable X11 Forwarding by Default" FontWeight="SemiBold"/>
                                        <TextBlock Text="New connections will have X11 forwarding enabled"
                                                   Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                                   FontSize="12"/>
                                    </StackPanel>
                                    <ui:ToggleSwitch Grid.Column="1" IsChecked="{Binding DefaultX11ForwardingEnabled, Mode=TwoWay}"/>
                                </Grid>

                                <!-- X Server path with browse button -->
                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="X Server Path" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                    <TextBlock Text="Path to VcXsrv, Xming, or X410 executable"
                                               FontSize="11" Opacity="0.5" Margin="0,0,0,4"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ui:TextBox Text="{Binding X11ServerPath, Mode=TwoWay}"
                                                    PlaceholderText="e.g., C:\Program Files\VcXsrv\vcxsrv.exe"/>
                                        <ui:Button Grid.Column="1" Content="Browse..." Margin="8,0,0,0"
                                                   Command="{Binding BrowseX11ServerPathCommand}"/>
                                    </Grid>
                                </StackPanel>

                                <!-- Auto launch toggle -->
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Auto Launch X Server" FontWeight="SemiBold"/>
                                        <TextBlock Text="Automatically start X server when opening X11 connections"
                                                   Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                                   FontSize="12"/>
                                    </StackPanel>
                                    <ui:ToggleSwitch Grid.Column="1" IsChecked="{Binding AutoLaunchXServer, Mode=TwoWay}"/>
                                </Grid>

                                <!-- Detect button with status -->
                                <StackPanel>
                                    <ui:Button Content="Detect X Server"
                                               Icon="{ui:SymbolIcon Search24}"
                                               Command="{Binding DetectX11ServerCommand}"
                                               Margin="0,0,0,8"/>

                                    <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                            CornerRadius="6"
                                            Padding="12"
                                            Visibility="{Binding X11ServerStatus, Converter={StaticResource StringToVisibilityConverter}}">
                                        <StackPanel>
                                            <TextBlock Text="X Server Status" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                            <TextBlock Text="{Binding X11ServerStatus}"
                                                       TextWrapping="Wrap"
                                                       FontFamily="Cascadia Mono"
                                                       FontSize="12"
                                                       Opacity="0.8"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </StackPanel>
                        </ui:CardExpander>
                    </StackPanel>

                    <!-- ===== Connection Category ===== -->
                    <StackPanel x:Name="ConnectionPanel">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedSettingsCategory}" Value="Connection">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Connection"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,16" />

                        <!-- Connection Defaults -->
                        <ui:CardExpander IsExpanded="True" Margin="0,0,0,8">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="Connection Defaults" FontWeight="SemiBold" />
                                    <TextBlock Text="Default settings for new connections"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <TextBlock Text="Default SSH Port" Margin="0,0,0,4" />
                                <ui:NumberBox Value="{Binding DefaultPort}"
                                              Minimum="1"
                                              Maximum="65535"
                                              SpinButtonPlacementMode="Compact"
                                              Margin="0,0,0,12" />

                                <TextBlock Text="Connection Timeout (seconds)" Margin="0,0,0,4" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="60" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="5"
                                            Maximum="120"
                                            Value="{Binding ConnectionTimeoutSeconds}"
                                            TickFrequency="5"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ConnectionTimeoutSeconds, StringFormat={}{0}s}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>

                                <TextBlock Text="Keep-Alive Interval (seconds, 0 to disable)" Margin="0,12,0,4" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="60" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="0"
                                            Maximum="300"
                                            Value="{Binding KeepAliveIntervalSeconds}"
                                            TickFrequency="15"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding KeepAliveIntervalSeconds, StringFormat={}{0}s}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>
                            </StackPanel>
                        </ui:CardExpander>

                        <!-- Auto-Reconnect -->
                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Auto-Reconnect" FontWeight="SemiBold" />
                                    <TextBlock Text="Automatically reconnect when connection is lost"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding AutoReconnect}" />
                        </ui:CardControl>

                        <!-- Reconnect Settings -->
                        <ui:CardExpander IsExpanded="False"
                                         Margin="0,0,0,8"
                                         Visibility="{Binding AutoReconnect, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="Reconnect Settings" FontWeight="SemiBold" />
                                    <TextBlock Text="Configure auto-reconnect behavior"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <TextBlock Text="Maximum Reconnect Attempts" Margin="0,0,0,4" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="40" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="1"
                                            Maximum="10"
                                            Value="{Binding MaxReconnectAttempts}"
                                            TickFrequency="1"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding MaxReconnectAttempts}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>
                            </StackPanel>
                        </ui:CardExpander>

                        <!-- Connection Pooling -->
                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Enable Connection Pooling" FontWeight="SemiBold" />
                                    <TextBlock Text="Reuse SSH connections to reduce latency"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding EnableConnectionPooling}" />
                        </ui:CardControl>

                        <ui:CardExpander IsExpanded="False"
                                         Margin="0,0,0,8"
                                         Visibility="{Binding EnableConnectionPooling, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="Connection Pool Settings" FontWeight="SemiBold" />
                                    <TextBlock Text="Configure connection reuse behavior"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <TextBlock Text="Maximum Connections Per Host" Margin="0,0,0,4" />
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="40" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="1"
                                            Maximum="10"
                                            Value="{Binding ConnectionPoolMaxPerHost}"
                                            TickFrequency="1"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ConnectionPoolMaxPerHost}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>
                                <TextBlock Text="Concurrent reusable connections per unique host"
                                           FontSize="11"
                                           Opacity="0.5"
                                           Margin="0,0,0,12" />

                                <TextBlock Text="Idle Timeout (seconds)" Margin="0,0,0,4" />
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="60" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="30"
                                            Maximum="3600"
                                            Value="{Binding ConnectionPoolIdleTimeoutSeconds}"
                                            TickFrequency="30"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ConnectionPoolIdleTimeoutSeconds, StringFormat={}{0}s}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>
                                <TextBlock Text="Close unused connections after this duration"
                                           FontSize="11"
                                           Opacity="0.5"
                                           Margin="0,0,0,0" />
                            </StackPanel>
                        </ui:CardExpander>
                    </StackPanel>

                    <!-- ===== Security Category ===== -->
                    <StackPanel x:Name="SecurityPanel">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedSettingsCategory}" Value="Security">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Security"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,16" />

                        <!-- Authentication -->
                        <ui:CardExpander IsExpanded="True" Margin="0,0,0,8">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="Authentication" FontWeight="SemiBold" />
                                    <TextBlock Text="Default authentication settings"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <TextBlock Text="Preferred Authentication Method" Margin="0,0,0,4" />
                                <ComboBox ItemsSource="{Binding AvailableAuthMethods}"
                                          SelectedItem="{Binding PreferredAuthMethod}"
                                          Margin="0,0,0,12" />

                                <TextBlock Text="Default SSH Key Path" Margin="0,0,0,4" />
                                <ui:TextBox PlaceholderText="e.g., C:\Users\you\.ssh\id_rsa"
                                            Text="{Binding DefaultKeyPath, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>
                        </ui:CardExpander>

                        <!-- SSH Key Manager -->
                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="SSH Key Manager" FontWeight="SemiBold" />
                                    <TextBlock Text="Generate, view, and manage SSH keys"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:Button Content="Manage Keys"
                                       Icon="{ui:SymbolIcon Key24}"
                                       Click="ManageSshKeysButton_Click" />
                        </ui:CardControl>

                        <!-- Credential Caching -->
                        <TextBlock Text="Credential Caching"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,16,0,12" />

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Enable Credential Caching" FontWeight="SemiBold" />
                                    <TextBlock Text="Cache passwords and passphrases in memory"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding EnableCredentialCaching}" />
                        </ui:CardControl>

                        <ui:CardExpander IsExpanded="False"
                                         Margin="0,0,0,8"
                                         Visibility="{Binding EnableCredentialCaching, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="Caching Settings" FontWeight="SemiBold" />
                                    <TextBlock Text="Configure credential cache behavior"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <TextBlock Text="Cache Timeout (minutes)" Margin="0,0,0,4" />
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="60" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="1"
                                            Maximum="60"
                                            Value="{Binding CredentialCacheTimeoutMinutes}"
                                            TickFrequency="5"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding CredentialCacheTimeoutMinutes, StringFormat={}{0} min}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>

                                <ui:CardControl Margin="0,0,0,8">
                                    <ui:CardControl.Header>
                                        <StackPanel>
                                            <TextBlock Text="Clear on Lock" FontWeight="SemiBold" />
                                            <TextBlock Text="Clear cache when Windows is locked"
                                                       FontSize="12" Opacity="0.6" />
                                        </StackPanel>
                                    </ui:CardControl.Header>
                                    <ui:ToggleSwitch IsChecked="{Binding ClearCacheOnLock}" />
                                </ui:CardControl>

                                <ui:CardControl Margin="0,0,0,0">
                                    <ui:CardControl.Header>
                                        <StackPanel>
                                            <TextBlock Text="Clear on Exit" FontWeight="SemiBold" />
                                            <TextBlock Text="Clear cache when application closes"
                                                       FontSize="12" Opacity="0.6" />
                                        </StackPanel>
                                    </ui:CardControl.Header>
                                    <ui:ToggleSwitch IsChecked="{Binding ClearCacheOnExit}" />
                                </ui:CardControl>
                            </StackPanel>
                        </ui:CardExpander>

                        <ui:CardControl Margin="0,0,0,8"
                                        Visibility="{Binding EnableCredentialCaching, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Clear Cache Now" FontWeight="SemiBold" />
                                    <TextBlock Text="Immediately clear all cached credentials"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:Button Content="Clear Cache"
                                       Appearance="Caution"
                                       Command="{Binding ClearCredentialCacheCommand}" />
                        </ui:CardControl>
                    </StackPanel>

                    <!-- ===== Appearance Category ===== -->
                    <StackPanel x:Name="AppearancePanel">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedSettingsCategory}" Value="Appearance">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Appearance"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,16" />

                        <!-- Theme -->
                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Theme" FontWeight="SemiBold" />
                                    <TextBlock Text="Application color theme"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ComboBox ItemsSource="{Binding AvailableThemes}"
                                      SelectedItem="{Binding Theme}"
                                      Width="120" />
                        </ui:CardControl>
                    </StackPanel>

                    <!-- ===== Behavior Category ===== -->
                    <StackPanel x:Name="BehaviorPanel">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedSettingsCategory}" Value="Behavior">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Behavior"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,16" />

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Confirm on Close" FontWeight="SemiBold" />
                                    <TextBlock Text="Show confirmation when closing active sessions"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding ConfirmOnClose}" />
                        </ui:CardControl>

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Remember Window Position" FontWeight="SemiBold" />
                                    <TextBlock Text="Save and restore window size and position"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding RememberWindowPosition}" />
                        </ui:CardControl>

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Start Minimized" FontWeight="SemiBold" />
                                    <TextBlock Text="Start the application minimized"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding StartMinimized}" />
                        </ui:CardControl>

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Minimize to Tray" FontWeight="SemiBold" />
                                    <TextBlock Text="Minimize to system tray instead of taskbar"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding MinimizeToTray}" />
                        </ui:CardControl>
                    </StackPanel>

                    <!-- ===== Data Category ===== -->
                    <StackPanel x:Name="DataPanel">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedSettingsCategory}" Value="Data">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Data"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,16" />

                        <!-- History Settings -->
                        <ui:CardExpander IsExpanded="True" Margin="0,0,0,8">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="History Settings" FontWeight="SemiBold" />
                                    <TextBlock Text="Configure connection history retention"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <TextBlock Text="Maximum History Entries" Margin="0,0,0,4" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="50" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="10"
                                            Maximum="500"
                                            Value="{Binding MaxHistoryEntries}"
                                            TickFrequency="10"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding MaxHistoryEntries}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>

                                <TextBlock Text="Auto-delete history older than (days, 0 = keep forever)" Margin="0,12,0,4" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="50" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="0"
                                            Maximum="365"
                                            Value="{Binding HistoryRetentionDays}"
                                            TickFrequency="30"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding HistoryRetentionDays}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>
                                <TextBlock Text="Cleanup runs on app startup"
                                           FontSize="11"
                                           Opacity="0.5"
                                           Margin="0,4,0,0" />
                            </StackPanel>
                        </ui:CardExpander>

                        <!-- Clear History -->
                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Clear History" FontWeight="SemiBold" />
                                    <TextBlock Text="Delete all recorded connection history"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:Button Content="Clear History"
                                       Appearance="Danger"
                                       Command="{Binding ClearHistoryCommand}" />
                        </ui:CardControl>

                        <!-- Session Logging -->
                        <TextBlock Text="Session Logging"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,16,0,12" />

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Enable Session Logging" FontWeight="SemiBold" />
                                    <TextBlock Text="Record terminal output to log files"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding EnableSessionLogging}" />
                        </ui:CardControl>

                        <ui:CardExpander IsExpanded="False"
                                         Margin="0,0,0,8"
                                         Visibility="{Binding EnableSessionLogging, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="Logging Settings" FontWeight="SemiBold" />
                                    <TextBlock Text="Configure session log output"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <TextBlock Text="Log Directory" Margin="0,0,0,4" />
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <ui:TextBox Grid.Column="0"
                                                PlaceholderText="Leave empty for default location"
                                                Text="{Binding SessionLogDirectory, UpdateSourceTrigger=PropertyChanged}"
                                                Margin="0,0,8,0" />
                                    <ui:Button Grid.Column="1"
                                               Content="Browse"
                                               Command="{Binding BrowseLogDirectoryCommand}"
                                               Margin="0,0,4,0" />
                                    <ui:Button Grid.Column="2"
                                               Icon="{ui:SymbolIcon FolderOpen24}"
                                               ToolTip="Open log directory"
                                               Command="{Binding OpenLogDirectoryCommand}" />
                                </Grid>

                                <TextBlock Text="Log Level" Margin="0,0,0,4" />
                                <ComboBox ItemsSource="{Binding AvailableSessionLogLevels}"
                                          SelectedItem="{Binding SessionLogLevel}"
                                          Margin="0,0,0,12" />

                                <ui:CardControl Margin="0,0,0,0">
                                    <ui:CardControl.Header>
                                        <StackPanel>
                                            <TextBlock Text="Timestamp Each Line" FontWeight="SemiBold" />
                                            <TextBlock Text="Add timestamp prefix to each logged line"
                                                       FontSize="12" Opacity="0.6" />
                                        </StackPanel>
                                    </ui:CardControl.Header>
                                    <ui:ToggleSwitch IsChecked="{Binding SessionLogTimestampLines}" />
                                </ui:CardControl>

                                <ui:CardControl Margin="0,8,0,0">
                                    <ui:CardControl.Header>
                                        <StackPanel>
                                            <TextBlock Text="Redact Typed Secrets" FontWeight="SemiBold" />
                                            <TextBlock Text="Hide typed commands from session logs"
                                                       FontSize="12" Opacity="0.6" />
                                        </StackPanel>
                                    </ui:CardControl.Header>
                                    <ui:ToggleSwitch IsChecked="{Binding RedactTypedSecrets}" />
                                </ui:CardControl>
                            </StackPanel>
                        </ui:CardExpander>
                    </StackPanel>

                    <!-- ===== Backup & Sync Category ===== -->
                    <StackPanel x:Name="BackupSyncPanel">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedSettingsCategory}" Value="Backup &amp; Sync">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Backup &amp; Sync"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,16" />

                        <!-- Import/Export -->
                        <TextBlock Text="Import / Export"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,12" />

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Import Hosts" FontWeight="SemiBold" />
                                    <TextBlock Text="Import hosts and groups from a JSON file"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:Button Content="Import"
                                       Icon="{ui:SymbolIcon ArrowDownload24}"
                                       Click="ImportButton_Click" />
                        </ui:CardControl>

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Import from SSH Config" FontWeight="SemiBold" />
                                    <TextBlock Text="Import hosts from ~/.ssh/config file"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:Button Content="Import SSH Config"
                                       Icon="{ui:SymbolIcon Document24}"
                                       Click="ImportSshConfigButton_Click" />
                        </ui:CardControl>

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Export Hosts" FontWeight="SemiBold" />
                                    <TextBlock Text="Export all hosts and groups to a JSON file"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:Button Content="Export"
                                       Icon="{ui:SymbolIcon ArrowUpload24}"
                                       Click="ExportButton_Click" />
                        </ui:CardControl>

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Export to SSH Config" FontWeight="SemiBold" />
                                    <TextBlock Text="Export hosts to ~/.ssh/config format"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:Button Content="Export SSH Config"
                                       Icon="{ui:SymbolIcon DocumentArrowRight24}"
                                       Click="ExportSshConfigButton_Click" />
                        </ui:CardControl>

                        <!-- Backup -->
                        <TextBlock Text="Backup"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,16,0,12" />

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Backup Manager" FontWeight="SemiBold" />
                                    <TextBlock Text="Create, restore, and manage backups"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:Button Content="Open Backup Manager"
                                       Icon="{ui:SymbolIcon FolderZip24}"
                                       Click="BackupManagerButton_Click" />
                        </ui:CardControl>

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Enable Automatic Backups" FontWeight="SemiBold" />
                                    <TextBlock Text="Automatically backup hosts at regular intervals"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding EnableAutoBackup}" />
                        </ui:CardControl>

                        <ui:CardExpander IsExpanded="False"
                                         Margin="0,0,0,8"
                                         Visibility="{Binding EnableAutoBackup, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ui:CardExpander.Header>
                                <StackPanel>
                                    <TextBlock Text="Backup Settings" FontWeight="SemiBold" />
                                    <TextBlock Text="Configure automatic backup behavior"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardExpander.Header>
                            <StackPanel Margin="8">
                                <TextBlock Text="Backup Interval (minutes)" Margin="0,0,0,4" />
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="60" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="15"
                                            Maximum="1440"
                                            Value="{Binding BackupIntervalMinutes}"
                                            TickFrequency="15"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding BackupIntervalMinutes, StringFormat={}{0} min}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>

                                <TextBlock Text="Maximum Backups to Keep" Margin="0,0,0,4" />
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="40" />
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="1"
                                            Maximum="50"
                                            Value="{Binding MaxBackupCount}"
                                            TickFrequency="1"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding MaxBackupCount}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right" />
                                </Grid>

                                <TextBlock Text="Backup Directory" Margin="0,0,0,4" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <ui:TextBox Grid.Column="0"
                                                PlaceholderText="Leave empty for default location"
                                                Text="{Binding BackupDirectory, UpdateSourceTrigger=PropertyChanged}"
                                                Margin="0,0,8,0" />
                                    <ui:Button Grid.Column="1"
                                               Content="Browse"
                                               Command="{Binding BrowseBackupDirectoryCommand}"
                                               Margin="0,0,4,0" />
                                    <ui:Button Grid.Column="2"
                                               Icon="{ui:SymbolIcon FolderOpen24}"
                                               ToolTip="Open backup directory"
                                               Command="{Binding OpenBackupDirectoryCommand}" />
                                </Grid>
                            </StackPanel>
                        </ui:CardExpander>

                        <!-- Cloud Sync -->
                        <TextBlock Text="Cloud Sync"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,16,0,12" />

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Cloud Sync Settings" FontWeight="SemiBold" />
                                    <TextBlock Text="Sync hosts across devices via OneDrive"
                                               FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:Button Content="Configure Cloud Sync"
                                       Icon="{ui:SymbolIcon CloudSync24}"
                                       Click="CloudSyncButton_Click" />
                        </ui:CardControl>
                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </Grid>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" Margin="24,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ui:Button Grid.Column="1"
                       Content="Cancel"
                       Command="{Binding CancelCommand}"
                       Margin="0,0,8,0"
                       MinWidth="80" />

            <ui:Button Grid.Column="2"
                       Content="Save"
                       Appearance="Primary"
                       Command="{Binding SaveCommand}"
                       MinWidth="80" />
        </Grid>
    </Grid>
</ui:FluentWindow>
