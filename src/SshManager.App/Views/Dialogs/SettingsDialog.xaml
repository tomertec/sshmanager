<ui:FluentWindow x:Class="SshManager.App.Views.Dialogs.SettingsDialog"
                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                xmlns:converters="clr-namespace:SshManager.App.Converters"
                mc:Ignorable="d"
                Title="Settings"
                Height="750" Width="550"
                MinHeight="650" MinWidth="500"
                WindowStartupLocation="CenterOwner"
                ResizeMode="NoResize"
                ExtendsContentIntoTitleBar="True"
                WindowBackdropType="Mica">

    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        <converters:BoolToPrimaryAppearanceConverter x:Key="BoolToPrimaryAppearanceConverter" />
        <converters:InverseBoolToPrimaryAppearanceConverter x:Key="InverseBoolToPrimaryAppearanceConverter" />
    </ui:FluentWindow.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0"
                     Title="Settings"
                     ShowMaximize="False"
                     ShowMinimize="False" />

        <!-- Settings Content -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      Padding="24,16">
            <StackPanel>
                <!-- ===== Terminal Section ===== -->
                <TextBlock Text="Terminal"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,0,0,12" />

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Terminal Mode" FontWeight="SemiBold" />
                            <TextBlock Text="Choose how SSH connections open"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                           CornerRadius="6"
                           BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                           BorderThickness="1"
                           Padding="4">
                        <StackPanel Orientation="Horizontal">
                            <ui:Button Content="Embedded"
                                      Icon="{ui:SymbolIcon Window24}"
                                      Appearance="{Binding UseEmbeddedTerminal, Converter={StaticResource BoolToPrimaryAppearanceConverter}}"
                                      Command="{Binding SetEmbeddedTerminalCommand}"
                                      CommandParameter="True"
                                      Padding="12,8"
                                      Margin="0,0,4,0" />
                            <ui:Button Content="External"
                                      Icon="{ui:SymbolIcon Open24}"
                                      Appearance="{Binding UseEmbeddedTerminal, Converter={StaticResource InverseBoolToPrimaryAppearanceConverter}}"
                                      Command="{Binding SetEmbeddedTerminalCommand}"
                                      CommandParameter="False"
                                      Padding="12,8" />
                        </StackPanel>
                    </Border>
                </ui:CardControl>

                <ui:CardExpander IsExpanded="False" Margin="0,0,0,8">
                    <ui:CardExpander.Header>
                        <StackPanel>
                            <TextBlock Text="Font Settings" FontWeight="SemiBold" />
                            <TextBlock Text="Customize terminal appearance"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardExpander.Header>
                    <StackPanel Margin="8">
                        <TextBlock Text="Font Family" Margin="0,0,0,4" />
                        <ComboBox ItemsSource="{Binding AvailableFonts}"
                                 SelectedItem="{Binding TerminalFontFamily}"
                                 Margin="0,0,0,12" />

                        <TextBlock Text="Font Size" Margin="0,0,0,4" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="60" />
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="8"
                                   Maximum="24"
                                   Value="{Binding TerminalFontSize}"
                                   TickFrequency="1"
                                   IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                      Text="{Binding TerminalFontSize, StringFormat={}{0} pt}"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right" />
                        </Grid>
                    </StackPanel>
                </ui:CardExpander>

                <ui:CardExpander IsExpanded="True" Margin="0,0,0,8">
                    <ui:CardExpander.Header>
                        <StackPanel>
                            <TextBlock Text="Terminal Theme" FontWeight="SemiBold" />
                            <TextBlock Text="Color scheme for the terminal"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardExpander.Header>
                    <StackPanel Margin="8">
                        <TextBlock Text="Select Theme" Margin="0,0,0,4" />
                        <ComboBox ItemsSource="{Binding AvailableTerminalThemes}"
                                 SelectedItem="{Binding SelectedTerminalTheme}"
                                 DisplayMemberPath="Name"
                                 Margin="0,0,0,12" />

                        <!-- Theme Preview -->
                        <TextBlock Text="Preview" Margin="0,0,0,4" FontWeight="SemiBold" />
                        <Border x:Name="ThemePreviewBorder"
                                Background="{Binding SelectedTerminalTheme.Background}"
                                CornerRadius="6"
                                Padding="12"
                                Margin="0,0,0,12"
                                MinHeight="80">
                            <StackPanel>
                                <TextBlock Text="user@server:~$ ls -la"
                                          FontFamily="Cascadia Mono"
                                          FontSize="12"
                                          Foreground="{Binding SelectedTerminalTheme.Foreground}" />
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock Text="drwxr-xr-x  " FontFamily="Cascadia Mono" FontSize="12"
                                              Foreground="{Binding SelectedTerminalTheme.Blue}" />
                                    <TextBlock Text="documents" FontFamily="Cascadia Mono" FontSize="12"
                                              Foreground="{Binding SelectedTerminalTheme.Blue}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                    <TextBlock Text="-rw-r--r--  " FontFamily="Cascadia Mono" FontSize="12"
                                              Foreground="{Binding SelectedTerminalTheme.Foreground}" />
                                    <TextBlock Text="config.yaml" FontFamily="Cascadia Mono" FontSize="12"
                                              Foreground="{Binding SelectedTerminalTheme.Green}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                    <TextBlock Text="-rwxr-xr-x  " FontFamily="Cascadia Mono" FontSize="12"
                                              Foreground="{Binding SelectedTerminalTheme.Foreground}" />
                                    <TextBlock Text="script.sh" FontFamily="Cascadia Mono" FontSize="12"
                                              Foreground="{Binding SelectedTerminalTheme.Red}" />
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Import/Export Buttons -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                            <ui:Button Content="Import Theme"
                                      Icon="{ui:SymbolIcon ArrowDownload24}"
                                      Command="{Binding ImportTerminalThemeCommand}"
                                      Margin="0,0,8,0" />
                            <ui:Button Content="Export Theme"
                                      Icon="{ui:SymbolIcon ArrowUpload24}"
                                      Command="{Binding ExportTerminalThemeCommand}"
                                      Margin="0,0,8,0" />
                            <ui:Button Content="Delete"
                                      Icon="{ui:SymbolIcon Delete24}"
                                      Appearance="Caution"
                                      Command="{Binding DeleteTerminalThemeCommand}"
                                      IsEnabled="{Binding SelectedTerminalTheme.IsBuiltIn, Converter={StaticResource InverseBoolConverter}, FallbackValue=False}" />
                        </StackPanel>
                    </StackPanel>
                </ui:CardExpander>

                <!-- ===== Connection Section ===== -->
                <TextBlock Text="Connection"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,16,0,12" />

                <ui:CardExpander IsExpanded="False" Margin="0,0,0,8">
                    <ui:CardExpander.Header>
                        <StackPanel>
                            <TextBlock Text="Connection Defaults" FontWeight="SemiBold" />
                            <TextBlock Text="Default settings for new connections"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardExpander.Header>
                    <StackPanel Margin="8">
                        <TextBlock Text="Default SSH Port" Margin="0,0,0,4" />
                        <ui:NumberBox Value="{Binding DefaultPort}"
                                     Minimum="1"
                                     Maximum="65535"
                                     SpinButtonPlacementMode="Compact"
                                     Margin="0,0,0,12" />

                        <TextBlock Text="Connection Timeout (seconds)" Margin="0,0,0,4" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="60" />
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="5"
                                   Maximum="120"
                                   Value="{Binding ConnectionTimeoutSeconds}"
                                   TickFrequency="5"
                                   IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                      Text="{Binding ConnectionTimeoutSeconds, StringFormat={}{0}s}"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right" />
                        </Grid>

                        <TextBlock Text="Keep-Alive Interval (seconds, 0 to disable)" Margin="0,12,0,4" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="60" />
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="0"
                                   Maximum="300"
                                   Value="{Binding KeepAliveIntervalSeconds}"
                                   TickFrequency="15"
                                   IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                      Text="{Binding KeepAliveIntervalSeconds, StringFormat={}{0}s}"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right" />
                        </Grid>
                    </StackPanel>
                </ui:CardExpander>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Auto-Reconnect" FontWeight="SemiBold" />
                            <TextBlock Text="Automatically reconnect when connection is lost"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:ToggleSwitch IsChecked="{Binding AutoReconnect}" />
                </ui:CardControl>

                <ui:CardExpander IsExpanded="False"
                                Margin="0,0,0,8"
                                Visibility="{Binding AutoReconnect, Converter={StaticResource BoolToVisibilityConverter}}">
                    <ui:CardExpander.Header>
                        <StackPanel>
                            <TextBlock Text="Reconnect Settings" FontWeight="SemiBold" />
                            <TextBlock Text="Configure auto-reconnect behavior"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardExpander.Header>
                    <StackPanel Margin="8">
                        <TextBlock Text="Maximum Reconnect Attempts" Margin="0,0,0,4" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="40" />
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="1"
                                   Maximum="10"
                                   Value="{Binding MaxReconnectAttempts}"
                                   TickFrequency="1"
                                   IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                      Text="{Binding MaxReconnectAttempts}"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right" />
                        </Grid>
                    </StackPanel>
                </ui:CardExpander>

                <!-- ===== Security Section ===== -->
                <TextBlock Text="Security"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,16,0,12" />

                <ui:CardExpander IsExpanded="False" Margin="0,0,0,8">
                    <ui:CardExpander.Header>
                        <StackPanel>
                            <TextBlock Text="Authentication" FontWeight="SemiBold" />
                            <TextBlock Text="Default authentication settings"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardExpander.Header>
                    <StackPanel Margin="8">
                        <TextBlock Text="Preferred Authentication Method" Margin="0,0,0,4" />
                        <ComboBox ItemsSource="{Binding AvailableAuthMethods}"
                                 SelectedItem="{Binding PreferredAuthMethod}"
                                 Margin="0,0,0,12" />

                        <TextBlock Text="Default SSH Key Path" Margin="0,0,0,4" />
                        <ui:TextBox PlaceholderText="e.g., C:\Users\you\.ssh\id_rsa"
                                   Text="{Binding DefaultKeyPath, UpdateSourceTrigger=PropertyChanged}" />
                    </StackPanel>
                </ui:CardExpander>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="SSH Key Manager" FontWeight="SemiBold" />
                            <TextBlock Text="Generate, view, and manage SSH keys"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:Button Content="Manage Keys"
                              Icon="{ui:SymbolIcon Key24}"
                              Click="ManageSshKeysButton_Click" />
                </ui:CardControl>

                <!-- ===== Credential Caching Section ===== -->
                <TextBlock Text="Credential Caching"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,16,0,12" />

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Enable Credential Caching" FontWeight="SemiBold" />
                            <TextBlock Text="Cache passwords and passphrases in memory"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:ToggleSwitch IsChecked="{Binding EnableCredentialCaching}" />
                </ui:CardControl>

                <ui:CardExpander IsExpanded="False"
                                Margin="0,0,0,8"
                                Visibility="{Binding EnableCredentialCaching, Converter={StaticResource BoolToVisibilityConverter}}">
                    <ui:CardExpander.Header>
                        <StackPanel>
                            <TextBlock Text="Caching Settings" FontWeight="SemiBold" />
                            <TextBlock Text="Configure credential cache behavior"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardExpander.Header>
                    <StackPanel Margin="8">
                        <TextBlock Text="Cache Timeout (minutes)" Margin="0,0,0,4" />
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="60" />
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="1"
                                   Maximum="60"
                                   Value="{Binding CredentialCacheTimeoutMinutes}"
                                   TickFrequency="5"
                                   IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                      Text="{Binding CredentialCacheTimeoutMinutes, StringFormat={}{0} min}"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right" />
                        </Grid>

                        <ui:CardControl Margin="0,0,0,8">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Clear on Lock" FontWeight="SemiBold" />
                                    <TextBlock Text="Clear cache when Windows is locked"
                                              FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding ClearCacheOnLock}" />
                        </ui:CardControl>

                        <ui:CardControl Margin="0,0,0,0">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Clear on Exit" FontWeight="SemiBold" />
                                    <TextBlock Text="Clear cache when application closes"
                                              FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding ClearCacheOnExit}" />
                        </ui:CardControl>
                    </StackPanel>
                </ui:CardExpander>

                <ui:CardControl Margin="0,0,0,8"
                               Visibility="{Binding EnableCredentialCaching, Converter={StaticResource BoolToVisibilityConverter}}">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Clear Cache Now" FontWeight="SemiBold" />
                            <TextBlock Text="Immediately clear all cached credentials"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:Button Content="Clear Cache"
                              Appearance="Caution"
                              Command="{Binding ClearCredentialCacheCommand}" />
                </ui:CardControl>

                <!-- ===== Appearance Section ===== -->
                <TextBlock Text="Appearance"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,16,0,12" />

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Theme" FontWeight="SemiBold" />
                            <TextBlock Text="Application color theme"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ComboBox ItemsSource="{Binding AvailableThemes}"
                             SelectedItem="{Binding Theme}"
                             Width="120" />
                </ui:CardControl>

                <!-- ===== Behavior Section ===== -->
                <TextBlock Text="Behavior"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,16,0,12" />

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Confirm on Close" FontWeight="SemiBold" />
                            <TextBlock Text="Show confirmation when closing active sessions"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:ToggleSwitch IsChecked="{Binding ConfirmOnClose}" />
                </ui:CardControl>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Remember Window Position" FontWeight="SemiBold" />
                            <TextBlock Text="Save and restore window size and position"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:ToggleSwitch IsChecked="{Binding RememberWindowPosition}" />
                </ui:CardControl>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Start Minimized" FontWeight="SemiBold" />
                            <TextBlock Text="Start the application minimized"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:ToggleSwitch IsChecked="{Binding StartMinimized}" />
                </ui:CardControl>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Minimize to Tray" FontWeight="SemiBold" />
                            <TextBlock Text="Minimize to system tray instead of taskbar"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:ToggleSwitch IsChecked="{Binding MinimizeToTray}" />
                </ui:CardControl>

                <!-- ===== Session Logging Section ===== -->
                <TextBlock Text="Session Logging"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,16,0,12" />

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Enable Session Logging" FontWeight="SemiBold" />
                            <TextBlock Text="Record terminal output to log files"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:ToggleSwitch IsChecked="{Binding EnableSessionLogging}" />
                </ui:CardControl>

                <ui:CardExpander IsExpanded="False"
                                Margin="0,0,0,8"
                                Visibility="{Binding EnableSessionLogging, Converter={StaticResource BoolToVisibilityConverter}}">
                    <ui:CardExpander.Header>
                        <StackPanel>
                            <TextBlock Text="Logging Settings" FontWeight="SemiBold" />
                            <TextBlock Text="Configure session log output"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardExpander.Header>
                    <StackPanel Margin="8">
                        <TextBlock Text="Log Directory" Margin="0,0,0,4" />
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <ui:TextBox Grid.Column="0"
                                       PlaceholderText="Leave empty for default location"
                                       Text="{Binding SessionLogDirectory, UpdateSourceTrigger=PropertyChanged}"
                                       Margin="0,0,8,0" />
                            <ui:Button Grid.Column="1"
                                      Content="Browse"
                                      Command="{Binding BrowseLogDirectoryCommand}"
                                      Margin="0,0,4,0" />
                            <ui:Button Grid.Column="2"
                                      Icon="{ui:SymbolIcon FolderOpen24}"
                                      ToolTip="Open log directory"
                                      Command="{Binding OpenLogDirectoryCommand}" />
                        </Grid>

                        <TextBlock Text="Log Level" Margin="0,0,0,4" />
                        <ComboBox ItemsSource="{Binding AvailableSessionLogLevels}"
                                 SelectedItem="{Binding SessionLogLevel}"
                                 Margin="0,0,0,12" />

                        <ui:CardControl Margin="0,0,0,0">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Timestamp Each Line" FontWeight="SemiBold" />
                                    <TextBlock Text="Add timestamp prefix to each logged line"
                                              FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding SessionLogTimestampLines}" />
                        </ui:CardControl>

                        <ui:CardControl Margin="0,8,0,0">
                            <ui:CardControl.Header>
                                <StackPanel>
                                    <TextBlock Text="Redact Typed Secrets" FontWeight="SemiBold" />
                                    <TextBlock Text="Hide typed commands from session logs"
                                              FontSize="12" Opacity="0.6" />
                                </StackPanel>
                            </ui:CardControl.Header>
                            <ui:ToggleSwitch IsChecked="{Binding RedactTypedSecrets}" />
                        </ui:CardControl>
                    </StackPanel>
                </ui:CardExpander>

                <!-- ===== Data Section ===== -->
                <TextBlock Text="Data"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,16,0,12" />

                <ui:CardExpander IsExpanded="False" Margin="0,0,0,8">
                    <ui:CardExpander.Header>
                        <StackPanel>
                            <TextBlock Text="History Settings" FontWeight="SemiBold" />
                            <TextBlock Text="Configure connection history retention"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardExpander.Header>
                    <StackPanel Margin="8">
                        <TextBlock Text="Maximum History Entries" Margin="0,0,0,4" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="50" />
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="10"
                                   Maximum="500"
                                   Value="{Binding MaxHistoryEntries}"
                                   TickFrequency="10"
                                   IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                      Text="{Binding MaxHistoryEntries}"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right" />
                        </Grid>

                        <TextBlock Text="Auto-delete history older than (days, 0 to disable)" Margin="0,12,0,4" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="50" />
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="0"
                                   Maximum="365"
                                   Value="{Binding HistoryRetentionDays}"
                                   TickFrequency="30"
                                   IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                      Text="{Binding HistoryRetentionDays}"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right" />
                        </Grid>
                    </StackPanel>
                </ui:CardExpander>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Clear History" FontWeight="SemiBold" />
                            <TextBlock Text="Delete all recorded connection history"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:Button Content="Clear History"
                              Appearance="Danger"
                              Command="{Binding ClearHistoryCommand}" />
                </ui:CardControl>

                <!-- ===== Import/Export Section ===== -->
                <TextBlock Text="Import / Export"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,16,0,12" />

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Import Hosts" FontWeight="SemiBold" />
                            <TextBlock Text="Import hosts and groups from a JSON file"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:Button Content="Import"
                              Icon="{ui:SymbolIcon ArrowDownload24}"
                              Click="ImportButton_Click" />
                </ui:CardControl>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Import from SSH Config" FontWeight="SemiBold" />
                            <TextBlock Text="Import hosts from ~/.ssh/config file"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:Button Content="Import SSH Config"
                              Icon="{ui:SymbolIcon Document24}"
                              Click="ImportSshConfigButton_Click" />
                </ui:CardControl>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Export Hosts" FontWeight="SemiBold" />
                            <TextBlock Text="Export all hosts and groups to a JSON file"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:Button Content="Export"
                              Icon="{ui:SymbolIcon ArrowUpload24}"
                              Click="ExportButton_Click" />
                </ui:CardControl>

                <!-- ===== Backup Section ===== -->
                <TextBlock Text="Backup"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,16,0,12" />

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Backup Manager" FontWeight="SemiBold" />
                            <TextBlock Text="Create, restore, and manage backups"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:Button Content="Open Backup Manager"
                              Icon="{ui:SymbolIcon FolderZip24}"
                              Click="BackupManagerButton_Click" />
                </ui:CardControl>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Enable Automatic Backups" FontWeight="SemiBold" />
                            <TextBlock Text="Automatically backup hosts at regular intervals"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:ToggleSwitch IsChecked="{Binding EnableAutoBackup}" />
                </ui:CardControl>

                <ui:CardExpander IsExpanded="False"
                                Margin="0,0,0,8"
                                Visibility="{Binding EnableAutoBackup, Converter={StaticResource BoolToVisibilityConverter}}">
                    <ui:CardExpander.Header>
                        <StackPanel>
                            <TextBlock Text="Backup Settings" FontWeight="SemiBold" />
                            <TextBlock Text="Configure automatic backup behavior"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardExpander.Header>
                    <StackPanel Margin="8">
                        <TextBlock Text="Backup Interval (minutes)" Margin="0,0,0,4" />
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="60" />
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="15"
                                   Maximum="1440"
                                   Value="{Binding BackupIntervalMinutes}"
                                   TickFrequency="15"
                                   IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                      Text="{Binding BackupIntervalMinutes, StringFormat={}{0} min}"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right" />
                        </Grid>

                        <TextBlock Text="Maximum Backups to Keep" Margin="0,0,0,4" />
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="40" />
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="1"
                                   Maximum="50"
                                   Value="{Binding MaxBackupCount}"
                                   TickFrequency="1"
                                   IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                      Text="{Binding MaxBackupCount}"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right" />
                        </Grid>

                        <TextBlock Text="Backup Directory" Margin="0,0,0,4" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <ui:TextBox Grid.Column="0"
                                       PlaceholderText="Leave empty for default location"
                                       Text="{Binding BackupDirectory, UpdateSourceTrigger=PropertyChanged}"
                                       Margin="0,0,8,0" />
                            <ui:Button Grid.Column="1"
                                      Content="Browse"
                                      Command="{Binding BrowseBackupDirectoryCommand}"
                                      Margin="0,0,4,0" />
                            <ui:Button Grid.Column="2"
                                      Icon="{ui:SymbolIcon FolderOpen24}"
                                      ToolTip="Open backup directory"
                                      Command="{Binding OpenBackupDirectoryCommand}" />
                        </Grid>
                    </StackPanel>
                </ui:CardExpander>

                <!-- ===== Cloud Sync Section ===== -->
                <TextBlock Text="Cloud Sync"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Margin="0,16,0,12" />

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Cloud Sync Settings" FontWeight="SemiBold" />
                            <TextBlock Text="Sync hosts across devices via OneDrive"
                                      FontSize="12" Opacity="0.6" />
                        </StackPanel>
                    </ui:CardControl.Header>
                    <ui:Button Content="Configure Cloud Sync"
                              Icon="{ui:SymbolIcon CloudSync24}"
                              Click="CloudSyncButton_Click" />
                </ui:CardControl>
            </StackPanel>
        </ScrollViewer>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" Margin="24,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ui:Button Grid.Column="1"
                      Content="Cancel"
                      Command="{Binding CancelCommand}"
                      Margin="0,0,8,0"
                      MinWidth="80" />

            <ui:Button Grid.Column="2"
                      Content="Save"
                      Appearance="Primary"
                      Command="{Binding SaveCommand}"
                      MinWidth="80" />
        </Grid>
    </Grid>
</ui:FluentWindow>
