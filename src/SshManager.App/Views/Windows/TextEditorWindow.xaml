<ui:FluentWindow x:Class="SshManager.App.Views.Windows.TextEditorWindow"
                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                xmlns:avalon="http://icsharpcode.net/sharpdevelop/avalonedit"
                mc:Ignorable="d"
                Title="{Binding WindowTitle}"
                Width="900" Height="650"
                MinWidth="600" MinHeight="400"
                WindowStartupLocation="CenterOwner"
                ExtendsContentIntoTitleBar="True"
                WindowBackdropType="Mica"
                Closing="Window_Closing">

    <ui:FluentWindow.InputBindings>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}" />
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding ElementName=EditorControl, Path=Tag}" />
        <KeyBinding Key="H" Modifiers="Ctrl" Command="{Binding ElementName=ReplaceButton, Path=Command}" />
        <KeyBinding Key="G" Modifiers="Ctrl" Command="{Binding ElementName=GoToLineButton, Path=Command}" />
        <KeyBinding Key="W" Modifiers="Ctrl" Command="{Binding CloseCommand}" />
    </ui:FluentWindow.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0"
                     Title="{Binding WindowTitle}"
                     ShowMaximize="True"
                     ShowMinimize="True" />

        <!-- Toolbar -->
        <Border Grid.Row="1"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                BorderThickness="0,0,0,1"
                Padding="8,4">
            <StackPanel Orientation="Horizontal">
                <!-- Save -->
                <ui:Button x:Name="SaveButton"
                          Appearance="Transparent"
                          Command="{Binding SaveCommand}"
                          ToolTip="Save (Ctrl+S)"
                          Padding="8,4"
                          Margin="0,0,4,0">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="Save24" />
                        <TextBlock Text="Save" Margin="6,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>
                </ui:Button>

                <!-- Reload -->
                <ui:Button x:Name="ReloadButton"
                          Appearance="Transparent"
                          Command="{Binding ReloadCommand}"
                          ToolTip="Reload from disk"
                          Padding="8,4"
                          Margin="0,0,4,0">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="ArrowSync24" />
                        <TextBlock Text="Reload" Margin="6,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>
                </ui:Button>

                <Separator Margin="8,0" />

                <!-- Find -->
                <ui:Button x:Name="FindButton"
                          Appearance="Transparent"
                          Click="FindButton_Click"
                          ToolTip="Find (Ctrl+F)"
                          Padding="8,4"
                          Margin="0,0,4,0">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="Search24" />
                        <TextBlock Text="Find" Margin="6,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>
                </ui:Button>

                <!-- Replace -->
                <ui:Button x:Name="ReplaceButton"
                          Appearance="Transparent"
                          Click="ReplaceButton_Click"
                          ToolTip="Replace (Ctrl+H)"
                          Padding="8,4"
                          Margin="0,0,4,0">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="TextDescription24" />
                        <TextBlock Text="Replace" Margin="6,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>
                </ui:Button>

                <Separator Margin="8,0" />

                <!-- Go to Line -->
                <ui:Button x:Name="GoToLineButton"
                          Appearance="Transparent"
                          Click="GoToLineButton_Click"
                          ToolTip="Go to Line (Ctrl+G)"
                          Padding="8,4"
                          Margin="0,0,4,0">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="ArrowDownload24" />
                        <TextBlock Text="Go to Line" Margin="6,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>
                </ui:Button>

                <!-- Word Wrap Toggle -->
                <ui:Button x:Name="WordWrapButton"
                          Appearance="Transparent"
                          Click="WordWrapButton_Click"
                          ToolTip="Toggle Word Wrap"
                          Padding="8,4">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="TextWrap24" />
                        <TextBlock Text="Wrap" Margin="6,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>
                </ui:Button>
            </StackPanel>
        </Border>

        <!-- Editor -->
        <avalon:TextEditor x:Name="EditorControl"
                          Grid.Row="2"
                          Document="{Binding Document}"
                          SyntaxHighlighting="{Binding HighlightingDefinition}"
                          FontFamily="Cascadia Code, Consolas, Courier New"
                          FontSize="14"
                          ShowLineNumbers="True"
                          HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Auto" />

        <!-- Status Bar -->
        <Border Grid.Row="3"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                BorderThickness="0,1,0,0"
                Padding="12,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- File Path / Status -->
                <TextBlock Grid.Column="0"
                          Text="{Binding StatusText}"
                          VerticalAlignment="Center"
                          TextTrimming="CharacterEllipsis"
                          Opacity="0.7" />

                <!-- Modified Indicator -->
                <TextBlock Grid.Column="1"
                          Text="{Binding ModifiedIndicator}"
                          Foreground="#FFB86C"
                          VerticalAlignment="Center"
                          Margin="16,0,0,0" />

                <!-- Encoding -->
                <TextBlock Grid.Column="2"
                          Text="{Binding Encoding.EncodingName}"
                          VerticalAlignment="Center"
                          Opacity="0.7"
                          Margin="16,0,0,0" />

                <!-- Line/Column -->
                <TextBlock Grid.Column="3"
                          VerticalAlignment="Center"
                          Opacity="0.7"
                          Margin="16,0,0,0">
                    <Run Text="Ln " />
                    <Run Text="{Binding LineNumber, Mode=OneWay}" />
                    <Run Text=", Col " />
                    <Run Text="{Binding ColumnNumber, Mode=OneWay}" />
                </TextBlock>

                <!-- Total Lines -->
                <TextBlock Grid.Column="4"
                          VerticalAlignment="Center"
                          Opacity="0.5"
                          Margin="16,0,0,0">
                    <Run Text="(" />
                    <Run Text="{Binding TotalLines, Mode=OneWay}" />
                    <Run Text=" lines)" />
                </TextBlock>
            </Grid>
        </Border>
    </Grid>
</ui:FluentWindow>
