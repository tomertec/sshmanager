<UserControl x:Class="SshManager.App.Views.Controls.CompletionPopup"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:vm="clr-namespace:SshManager.App.ViewModels"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:CompletionPopupViewModel}"
             d:DesignHeight="200" d:DesignWidth="300"
             Visibility="{Binding IsVisible, Converter={StaticResource BooleanToVisibilityConverter}}">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary>
                    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
                    <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter" xmlns:converters="clr-namespace:SshManager.App.Converters" />
                </ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>

        <!-- ListBoxItem style for completion items -->
        <Style x:Key="CompletionItemStyle" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="8,6" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="3"
                                Margin="2">
                            <ContentPresenter />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3F3F46" />
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#3B82F6" />
                </Trigger>
            </Style.Triggers>
        </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Border Background="#2D2D30"
            BorderBrush="#3F3F46"
            BorderThickness="1"
            CornerRadius="6"
            Padding="4">
        <Border.Effect>
            <DropShadowEffect BlurRadius="12"
                              ShadowDepth="3"
                              Opacity="0.5"
                              Color="Black" />
        </Border.Effect>

        <ListBox x:Name="CompletionListBox"
                 ItemsSource="{Binding Items}"
                 SelectedIndex="{Binding SelectedIndex, Mode=TwoWay}"
                 MaxHeight="250"
                 Background="Transparent"
                 BorderThickness="0"
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                 ItemContainerStyle="{StaticResource CompletionItemStyle}"
                 KeyDown="CompletionListBox_KeyDown"
                 PreviewKeyDown="CompletionListBox_PreviewKeyDown">

            <ListBox.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Horizontal">
                        <!-- Icon based on CompletionItemType -->
                        <TextBlock Text="{Binding IconGlyph}"
                                   FontFamily="Segoe Fluent Icons"
                                   FontSize="16"
                                   Width="24"
                                   VerticalAlignment="Center"
                                   Foreground="#E0E0E0"
                                   Margin="0,0,8,0" />

                        <!-- Display text with monospace font -->
                        <TextBlock Text="{Binding DisplayText}"
                                   FontFamily="Cascadia Mono, Consolas, Courier New"
                                   FontSize="13"
                                   VerticalAlignment="Center"
                                   Foreground="White"
                                   TextTrimming="CharacterEllipsis" />

                        <!-- Optional description -->
                        <TextBlock Text="{Binding Description}"
                                   FontFamily="Segoe UI"
                                   FontSize="11"
                                   VerticalAlignment="Center"
                                   Foreground="#A0A0A0"
                                   Margin="12,0,0,0"
                                   TextTrimming="CharacterEllipsis"
                                   Visibility="{Binding Description, Converter={StaticResource StringToVisibilityConverter}}" />
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Border>
</UserControl>
